# GRPC TEST with metrics&k8s 

## Содержание 
- [Запуск](#запуск)
- [Примеры запросов и ответов](#примеры-запросов-и-ответов)
- [ТЗ](#тз)
## Запуск
Запустить в докере mongodb, prometheus, grafana
```sh
$ make compose-up
```
Запуск сервера
```sh
$ make run
```
Запуск нагрузочного тестирования
```sh
$ make grpc-load-test
```
Запуск нагрузочного тестирования c ошибками
```sh
$ make grpc-error-load-test
```
### Зависимости
- go 1.22
- docker & docker-compose



## Примеры запросов и ответов

### product_v1.ProductV1.Fetch

Создание нового баннера

##### Запрос:
```
{
    "value": "https://gist.githubusercontent.com/petroniocandido/dbab9321b7d5770b7549682436bb2073/raw/6b41d4a7d1a1f610baed5b0df3802daca8672bc3/products.csv"
}

```

### product_v1.ProductV1.List

Получение баннера для пользователя

##### Запрос:
```
{
    "page_number": "1",
    "page_size": "100",
    "sort_ascending": {
        "value": false
    },
    "sort_by": {
        "value": "name"
    }
}
```


## ТЗ
## Описание задачи
Требуется написать gRPC-сервер на языке GoLang , с постоянным хранилищем MongoDB, реализующий 2 метода:

- Fetch(URL) - запросить внешний CSV-файл со списком продуктов по внешнему адресу. CSV-файл имеет вид PRODUCT NAME;PRICE. Последняя цена каждого продукта должна быть сохранена в базе с датой запроса. Также нужно сохранять количество изменений цены продукта.

- List(&lt;paging params&gt;, &lt;sorting params&gt;) - получить постраничный список продуктов с их ценами, количеством изменений цены и датами их последнего обновления. Предусмотреть все варианты сортировки для реализации интерфейса в виде бесконечного скролла

## Что сделал в ходе работы

Протестировал prometheus и grafana, grpc validate, k8s (чтобы запустить несколько реплик сервера) 

